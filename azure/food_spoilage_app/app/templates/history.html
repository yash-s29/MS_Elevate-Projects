<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prediction History ‚Ä¢ Spoilage Predictor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- ================= ANIMATED BACKGROUND ================= -->
<div class="background-animation">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
</div>

<!-- ================= NAVBAR ================= -->
<nav class="navbar">
    <div class="nav-container">
        <a href="/" class="nav-brand">
            <span class="brand-icon animate-float">üçÉ</span>
            <span class="brand-text">Spoilage Predictor</span>
        </a>

        <ul class="nav-links">
            <li><a href="/" class="nav-link" data-link="home">Home</a></li>
            <li><a href="/#about" class="nav-link" data-link="about" onclick="scrollToSection(event, 'about-section')">About</a></li>
            <li><a href="/feedback" class="nav-link" data-link="feedback">Feedback</a></li>
            <li><a href="/history" class="nav-link active" data-link="history">History</a></li>
        </ul>
    </div>
</nav>

<!-- ================= PAGE HEADER ================= -->
<header class="page-header">
    <div class="page-header-content">
        <div class="page-eyebrow">üìã Your Records</div>
        <h1 class="page-title">Prediction History</h1>
        <p class="page-subtitle">View and manage all your storage analysis predictions</p>
    </div>
</header>

<!-- ================= MAIN ================= -->
<main class="main-container">

    {% if rows %}
    <section class="glass-card history-section stagger-in">
        <div class="section-header">
            <div class="section-badge">üìã ANALYSIS RECORDS</div>
            <h2>Your Predictions</h2>
            <p>{{ rows|length }} record{{ 's' if rows|length != 1 else '' }} found</p>
        </div>

        <div class="table-wrapper">
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Food Item</th>
                        <th>Temperature</th>
                        <th>Humidity</th>
                        <th>Light Level</th>
                        <th>CO‚ÇÇ Level</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr class="table-row" data-id="{{ row.id }}">
                        <td class="cell-food"><span class="food-name">{{ row.fruit }}</span></td>
                        <td>{{ "%.1f"|format(row.temp) }}¬∞C</td>
                        <td>{{ "%.1f"|format(row.humid) }}%</td>
                        <td>{{ "%.1f"|format(row.light) }} lux</td>
                        <td>{{ "%.0f"|format(row.co2) }} ppm</td>
                        <td>
                            <button class="status-badge {% if row.prediction == 'Good' %}status-good{% else %}status-bad{% endif %}" 
                                    data-status="{{ row.prediction }}"
                                    onclick="showStatusDetails(event)">
                                {{ row.prediction }}
                            </button>
                        </td>
                        <td class="cell-time">{{ row.timestamp.split(' ')[0] }}</td>
                        <td class="cell-action">
                            <button class="btn-delete" data-id="{{ row.id }}" data-fruit="{{ row.fruit }}" data-prediction="{{ row.prediction }}" onclick="handleDeleteClick(this)" title="Delete this record">‚úï</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="history-footer">
            <a href="/" class="btn-secondary">‚Üê Make New Prediction</a>
        </div>

    </section>
    {% else %}
    <section class="glass-card empty-state-section">
        <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h2>No Predictions Yet</h2>
            <p>Start analyzing your storage conditions to see results here</p>
            <a href="/" class="btn-primary">Make Your First Prediction</a>
        </div>
    </section>
    {% endif %}

</main>

<!-- ================= DELETE MODAL ================= -->
<div id="deleteModal" class="modal">
    <div class="modal-backdrop" onclick="closeDeleteModal()"></div>
    <div class="modal-content modal-delete">
        <div class="modal-header">
            <h2>Delete Record</h2>
            <button class="modal-close" onclick="closeDeleteModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this prediction record?</p>
            <div class="record-preview">
                <div class="preview-item">
                    <span class="preview-label">Food Item:</span>
                    <span class="preview-value" id="modalFoodName">‚Äî</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">Status:</span>
                    <span class="preview-value" id="modalPrediction">‚Äî</span>
                </div>
            </div>
            <p class="warning-text">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <form id="deleteForm" method="POST" style="width: 100%;">
                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                    <button type="submit" class="btn-danger">Delete Record</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ================= STATUS DETAILS MODAL ================= -->
<div id="statusModal" class="modal">
    <div class="modal-backdrop" onclick="closeStatusModal()"></div>
    <div class="modal-content modal-status">
        <div class="modal-header">
            <h2>Storage Status</h2>
            <button class="modal-close" onclick="closeStatusModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="status-details" id="statusDetails"></div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-primary" onclick="closeStatusModal()">Understood</button>
        </div>
    </div>
</div>

<!-- ================= FOOTER ================= -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-main">
            <h3>Spoilage Predictor</h3>
            <p>Track and analyze your storage conditions</p>
        </div>
        <div class="footer-divider"></div>
        <p class="footer-copyright">
            ¬© 2026 Spoilage Predictor ‚Ä¢ Intelligent Food Storage
        </p>
    </div>
</footer>

<!-- ================= SCRIPTS ================= -->
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
<script>
function handleDeleteClick(button) {
    const id = button.dataset.id;
    const fruit = button.dataset.fruit;
    const prediction = button.dataset.prediction;
    openDeleteModal(id, fruit, prediction);
}

function openDeleteModal(id, food, prediction) {
    document.getElementById('modalFoodName').textContent = food;
    document.getElementById('modalPrediction').textContent = prediction;
    const form = document.getElementById('deleteForm');
    form.action = `/delete/${id}`;
    document.getElementById('deleteModal').classList.add('open');
    document.body.style.overflow = 'hidden';
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.remove('open');
    document.body.style.overflow = '';
}

function showStatusDetails(event) {
    event.preventDefault();
    const status = event.target.dataset.status;
    const statusDetails = document.getElementById('statusDetails');
    
    if (status === 'Good') {
        statusDetails.innerHTML = `
            <div class="status-symbol status-good-large">‚úì</div>
            <h3>Storage Conditions Optimal</h3>
            <p>Your storage environment is well-maintained.</p>
            <div class="status-info">
                <strong>What this means:</strong>
                <ul>
                    <li>Temperature and humidity are in ideal ranges</li>
                    <li>Light exposure is minimal</li>
                    <li>CO‚ÇÇ levels are appropriate</li>
                </ul>
            </div>
        `;
    } else {
        statusDetails.innerHTML = `
            <div class="status-symbol status-bad-large">‚ö†</div>
            <h3>Spoilage Risk Detected</h3>
            <p>Storage conditions may accelerate spoilage.</p>
            <div class="status-info">
                <strong>Recommended Actions:</strong>
                <ul>
                    <li>Adjust temperature settings</li>
                    <li>Regulate humidity levels</li>
                    <li>Minimize light exposure</li>
                </ul>
            </div>
        `;
    }
    document.getElementById('statusModal').classList.add('open');
    document.body.style.overflow = 'hidden';
}

function closeStatusModal() {
    document.getElementById('statusModal').classList.remove('open');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeDeleteModal();
        closeStatusModal();
    }
});
</script>

</body>
</html>
